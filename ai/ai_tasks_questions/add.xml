<?xml version="1.0" encoding="utf-8"?>
<form>
  <AjaxForm>1</AjaxForm>
  <AllowedCapability>u::CAPABILITY_POST_DEVELOPMENT_DIRECTORS;,u::CAPABILITY_AI_TASK_EDIT;</AllowedCapability>
  <AllowedUsersGroups>ag::admin;</AllowedUsersGroups>
  <FormID>add</FormID>
  <GroupID>ai_tasks_questions</GroupID>
  <Label>Добавить</Label>
  <Name>add</Name>
  <Redirect>type=ai_tasks_questions&amp;act=select&amp;id=@id;</Redirect>
  <SQL>insert into ai_tasks_questions set QuestionID='@QuestionID;', TaskID='@id;';
    ##^logTable('ai_tasks_questions', 1, 'DB::$insertedID;');</SQL>
  <SQLselect>SELECT TypeID
FROM ai_tasks
WHERE TaskID = '@id;'</SQLselect>
  <SubmitBtn>1</SubmitBtn>
  <SuccessMsg>Успешно добавлено!</SuccessMsg>
  <TableName>ai_tasks_questions</TableName>
  <Inputs>
    <Label>Тип вопроса</Label>
    <Name>TypeID</Name>
    <Needed>1</Needed>
    <SQL>SELECT ID, TypeName as Name FROM ai_questions_types ORDER BY ID</SQL>
    <Type>29</Type>
  </Inputs>
  <Inputs>
    <Label>Вопрос</Label>
    <Name>QuestionID</Name>
    <Needed>1</Needed>
    <SQL>SELECT
        aiq.ID,
        if(aiq.QuestionName != '', aiq.QuestionName, aiq.QuestionText) as QuestionText,
        '',
        aiq.TypeID
      FROM ai_questions aiq
      LEFT JOIN ai_tasks_questions aitq ON aitq.QuestionID=aiq.ID AND aitq.TaskID='@masterid;'
      WHERE aitq.ID IS null ORDER BY aiq.ID ASC</SQL>
    <Type>29</Type>
  </Inputs>
  <Inputs>
    <DefaultValue>
      function hideQuestions(curVal) {
      $("#QuestionID option").each(function() {
      if($(this).attr('data-item') &amp;&amp; $(this).attr('data-item')!=curVal)
      $(this).hide(); else
      $(this).show();
      });
      $('#QuestionID').selectpicker('refresh');
      }
      hideQuestions($('#TypeID').val());
      $('#TypeID').change(function(){
      $("#QuestionID").val('');
      hideQuestions($(this).val());
      });
    </DefaultValue>
    <Name>Script</Name>
    <Type>55</Type>
  </Inputs>
</form>
