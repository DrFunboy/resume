<?xml version="1.0" encoding="utf-8"?>
<form>
  <AddBtn>add</AddBtn>
  <AllowedCapability>u::CAPABILITY_AI_TASK_VIEW;,u::CAPABILITY_AI_TASK_EDIT;</AllowedCapability>
  <AllowedUsersGroups>ag::admin;</AllowedUsersGroups>
  <DropBtn>delete</DropBtn>
  <EditBtn>edit</EditBtn>
  <FormID>select</FormID>
  <GroupID>ai_action_tasks</GroupID>
  <Label>Задачи на анализ действий</Label>
  <Menu_item>1</Menu_item>
  <Name>select</Name>
  <PerPage>100</PerPage>
  <SQLselect>SELECT at.TaskID,
  at.TaskName,
  at.DateStart,
  at.DateEnd,
  GROUP_CONCAT(DISTINCT am.Name ORDER BY am.ID ASC SEPARATOR '&lt;br&gt;') AS AiModels,
  at.Prompt,
  IF(at.active AND CURDATE() BETWEEN at.DateStart AND COALESCE(at.DateEnd, CURDATE()), 'Да', '') AS Active,
  aip.PromptName,
  att.Name as TaskTypeName
FROM ai_tasks at
LEFT JOIN ai_tasks_ai_models atm ON atm.TaskID = at.TaskID
LEFT JOIN ai_models am ON am.ID = atm.AIModelID
LEFT JOIN ai_prompts aip ON aip.PromptID = at.PromptID
INNER JOIN ai_task_type att ON att.TypeID = at.TypeID
WHERE at.TypeID IN (2,3)
GROUP BY at.TaskID
ORDER BY at.active, at.TaskName</SQLselect>
  <Inputs>
    <Label>Название</Label>
    <Name>TaskName</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>Тип</Label>
    <Name>TaskTypeName</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>С даты</Label>
    <Name>DateStart</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>По дату</Label>
    <Name>DateEnd</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>ИИ-модели</Label>
    <Name>AiModels</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>Контекст</Label>
    <Name>PromptName</Name>
    <Type>2</Type>
  </Inputs>
  <Inputs>
    <Label>Запрос</Label>
    <Name>Prompt</Name>
    <Type>1</Type>
  </Inputs>
  <Inputs>
    <Label>Активна</Label>
    <Name>Active</Name>
    <Type>2</Type>
  </Inputs>
</form>
